const events = [
    {
      nameEn: "Khmer New Year",
      nameKh: "áž”áž»ážŽáŸ’áž™áž…áž¼áž›áž†áŸ’áž“áž¶áŸ†ážáŸ’áž˜áŸ‚ážš",
      date: "2026-04-14",
      funFactEn:
        "Khmer New Year is celebrated for three days, each with its own special meaning.",
      funFactKh:
        "áž”áž»ážŽáŸ’áž™áž…áž¼áž›áž†áŸ’áž“áž¶áŸ†ážáŸ’áž˜áŸ‚ážšážáŸ’ážšáž¼ážœáž”áž¶áž“áž”áŸ’ážšáž¶ážšáž–áŸ’áž’áž¡áž¾áž„ážšáž™áŸˆáž–áŸáž›áž”áž¸ážáŸ’áž„áŸƒ ážŠáŸ„áž™ážáŸ’áž„áŸƒáž“áž¸áž˜áž½áž™áŸ—áž˜áž¶áž“áž¢ážáŸ’ážáž“áŸáž™áž–áž·ážŸáŸážŸážšáŸ€áž„áŸ—ážáŸ’áž›áž½áž“áŸ”",
      image:
        "https://www.redbus.com.kh/blogs/wp-content/uploads/2024/03/Khmer-new-year-2024.jpg?height=200&width=600&text=Khmer+New+Year",
    },
    {
      nameEn: "Water Festival",
      nameKh: "áž”áž»ážŽáŸ’áž™áž¢áž»áŸ†áž‘áž¼áž€",
      date: "2025-11-04",
      funFactEn:
        "The Water Festival commemorates the end of the rainy season and the reversal of flow of the Tonle Sap River.",
      funFactKh:
        "áž–áž·áž’áž¸áž”áž»ážŽáŸ’áž™áž¢áž»áŸ†áž‘áž¼áž€áž‚ážºáž‡áž¶áž€áž¶ážšáž”áŸ’ážšáž¶ážšáž–áŸ’áž’áž–áž·áž’áž¸áž”áž‰áŸ’áž…áž”áŸ‹ážšážŠáž¼ážœážœážŸáŸ’ážŸáž¶ áž“áž·áž„áž€áž¶ážšáž”áž‰áŸ’áž…áŸ’ážšáž¶ážŸáž‘áž·ážŸáž“áŸƒáž…ážšáž“áŸ’ážáž‘áž¹áž€áž‘áž“áŸ’áž›áŸážŸáž¶áž”áŸ”",
      image:
        "https://cdn.pixabay.com/photo/2019/10/15/05/41/khmer-water-festival-4550646_1280.jpg?height=200&width=600&text=Water+Festival",
    },
    {
      nameEn: "Pchum Ben",
      nameKh: "áž”áž»ážŽáŸ’áž™áž—áŸ’áž‡áž»áŸ†áž”áž·ážŽáŸ’ážŒ",
      date: "2025-9-23",
      funFactEn:
        "Pchum Ben is a 15-day Cambodian religious festival, culminating in celebrations on the 15th day of the tenth month in the Khmer calendar.",
      funFactKh:
        "áž”áž»ážŽáŸ’áž™áž—áŸ’áž‡áž»áŸ†áž”áž·ážŽáŸ’ážŒáž‚ážºáž‡áž¶áž–áž·áž’áž¸áž”áž»ážŽáŸ’áž™ážŸáž¶ážŸáž“áž¶ážáŸ’áž˜áŸ‚ážšážŠáŸ‚áž›áž˜áž¶áž“ážšáž™áŸˆáž–áŸáž›áŸ¡áŸ¥ážáŸ’áž„áŸƒ ážŠáŸ„áž™ážáŸ’áž„áŸƒážŸáŸ†ážáž¶áž“áŸ‹áž”áŸ†áž•áž»ážáž‚ážºáž“áŸ…ážáŸ’áž„áŸƒáž‘áž¸áŸ¡áŸ¥áž“áŸƒážáŸ‚áž‘áž¸áŸ¡áŸ áž€áŸ’áž“áž»áž„áž”áŸ’ážšážáž·áž‘áž·áž“ážáŸ’áž˜áŸ‚ážšáŸ”",
      image:
        "https://www.redbus.com.kh/blogs/wp-content/uploads/2024/08/Pchum-Ben-2024_11zon-1.jpg?height=200&width=600&text=Pchum+Ben",
    },
    {
      nameEn: "Bac II Exam",
      nameKh: "áž€áž¶ážšáž”áŸ’ážšáž¡áž„ážŸáž‰áŸ’áž‰áž¶áž”ážáŸ’ážšáž˜áž’áŸ’áž™áž˜ážŸáž·áž€áŸ’ážŸáž¶áž‘áž»ážáž·áž™áž—áž¼áž˜áž·",
      date: "2025-08-18",
      funFactEn:
        "The Bac II Exam is a crucial milestone for Cambodian students, determining their eligibility for university admission.",
      funFactKh:
        "áž€áž¶ážšáž”áŸ’ážšáž¡áž„ážŸáž‰áŸ’áž‰áž¶áž”ážáŸ’ážšáž˜áž’áŸ’áž™áž˜ážŸáž·áž€áŸ’ážŸáž¶áž‘áž»ážáž·áž™áž—áž¼áž˜áž·áž‚ážºáž‡áž¶áž€áž¶ážšáž”áŸ’ážšáž¡áž„ážŠáŸážŸáŸ†ážáž¶áž“áŸ‹ážŸáž˜áŸ’ážšáž¶áž”áŸ‹ážŸáž·ážŸáŸ’ážŸážáŸ’áž˜áŸ‚ážš ážŠáŸ‚áž›áž€áŸ†ážŽážáŸ‹áž›áž‘áŸ’áž’áž—áž¶áž–áž€áŸ’áž“áž»áž„áž€áž¶ážšáž…áž¼áž›ážšáŸ€áž“áž“áŸ…ážŸáž¶áž€áž›ážœáž·áž‘áŸ’áž™áž¶áž›áŸáž™áŸ”",
      image:
        "https://pppenglish.sgp1.digitaloceanspaces.com/image/main/field/image/topic-9.-2nd-day-of-bacii-exam-2019-at-boung-trobek-high-school-on-august-20-by-hean-rangsey-1.jpg?height=200&width=600&text=Bac+II+Exam",
    },
    {
      nameEn: "Visak Bochea",
      nameKh: "áž–áž·áž’áž¸áž”áž»ážŽáŸ’áž™ážœáž·ážŸáž¶ážáž”áž¼áž‡áž¶",
      date: "2025-05-11",
      funFactEn:
        "Visak Bochea commemorates the birth, enlightenment, and death of Buddha, which all occurred on the same date in different years.",
      funFactKh:
        "áž–áž·áž’áž¸áž”áž»ážŽáŸ’áž™ážœáž·ážŸáž¶ážáž”áž¼áž‡áž¶áž‚ážºáž‡áž¶áž€áž¶ážšážšáŸ†áž­áž€ážŠáž›áŸ‹ážáŸ’áž„áŸƒáž”áŸ’ážšážŸáž¼ážáŸ’ážš ážáŸ’ážšáž¶ážŸáŸ‹ážŠáž¹áž„ áž“áž·áž„áž”ážšáž·áž“áž·áž–áŸ’ážœáž¶áž“ážšáž”ážŸáŸ‹áž–áŸ’ážšáŸ‡áž–áž»áž‘áŸ’áž’ ážŠáŸ‚áž›áž”áž¶áž“áž€áž¾ážáž¡áž¾áž„áž“áŸ…ážáŸ’áž„áŸƒážŠáž¼áž…áž‚áŸ’áž“áž¶áž€áŸ’áž“áž»áž„áž†áŸ’áž“áž¶áŸ†áž•áŸ’ážŸáŸáž„áŸ—áž‚áŸ’áž“áž¶áŸ”",
      image:
        "https://scontent.fpnh2-1.fna.fbcdn.net/v/t39.30808-6/280445723_10160770248125676_7931910641505046942_n.jpg?_nc_cat=104&ccb=1-7&_nc_sid=127cfc&_nc_eui2=AeF5hXBAb2V-ccF2mxPc9tcTHmwSXifVin4ebBJeJ9WKfhh_OIuri1TydlLMJudfErpg2weyl3i4d-IxtajgPQeV&_nc_ohc=t7ZnwsjJB0oQ7kNvwFl4Y0P&_nc_oc=Adn1ZUUFRgDq4-dP9akYpVV7bw1X2HyYJmO0dVFECy4gAmIvyP-Jz9cEhAURPxHVJUs&_nc_zt=23&_nc_ht=scontent.fpnh2-1.fna&_nc_gid=UXXQZLJXNDOyp43nNHTSWQ&oh=00_AfHEoR12mgyXHGDW5uYuGO-Q2F_IrdA8lVPMGrJrX9-ILg&oe=680E46EC",
    },
    {
      nameEn: "Diploma Exam (Grade 9)",
      nameKh: "áž€áž¶ážšáž”áŸ’ážšáž¡áž„ážŸáž‰áŸ’áž‰áž¶áž”ážáŸ’ážšáž”áž‹áž˜ážŸáž·áž€áŸ’ážŸáž¶áž‘áž»ážáž·áž™áž—áž¼áž˜áž·",
      date: "2025-06-15",
      funFactEn:
        "The Grade 9 Diploma Exam marks the completion of lower secondary education in Cambodia.",
      funFactKh:
        "áž€áž¶ážšáž”áŸ’ážšáž¡áž„ážŸáž‰áŸ’áž‰áž¶áž”ážáŸ’ážšáž”áž‹áž˜ážŸáž·áž€áŸ’ážŸáž¶áž‘áž»ážáž·áž™áž—áž¼áž˜áž·áž‚ážºáž‡áž¶áž€áž¶ážšáž”áž‰áŸ’áž…áž”áŸ‹áž€áž¶ážšážŸáž·áž€áŸ’ážŸáž¶ážáŸ’áž“áž¶áž€áŸ‹áž˜áž’áŸ’áž™áž˜ážŸáž·áž€áŸ’ážŸáž¶áž”áž‹áž˜áž—áž¼áž˜áž·áž“áŸ…áž€áž˜áŸ’áž–áž»áž‡áž¶áŸ”",
      image:
        "https://education.ams.com.kh/wp-content/uploads/2022/12/Ba_02-1.jpg",
    },
  ];

  let currentEventIndex = 0;
  let isKhmer = true;

  const khmerNumerals = ["áŸ ", "áŸ¡", "áŸ¢", "áŸ£", "áŸ¤", "áŸ¥", "áŸ¦", "áŸ§", "áŸ¨", "áŸ©"];

  function toKhmerNumeral(num) {
    return num
      .toString()
      .split("")
      .map((digit) => khmerNumerals[parseInt(digit)])
      .join("");
  }

  function updateCountdown() {
    const currentEvent = events[currentEventIndex];
    const eventDate = new Date(currentEvent.date);
    const now = new Date();
    const difference = eventDate - now;
    const totalDuration =
      eventDate -
      new Date(
        events[(currentEventIndex - 1 + events.length) % events.length].date
      );

    const days = Math.floor(difference / (1000 * 60 * 60 * 24));
    const hours = Math.floor(
      (difference % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60)
    );
    const minutes = Math.floor(
      (difference % (1000 * 60 * 60)) / (1000 * 60)
    );
    const seconds = Math.floor((difference % (1000 * 60)) / 1000);

    document.getElementById("eventName").textContent = isKhmer
      ? currentEvent.nameKh
      : currentEvent.nameEn;
    document.getElementById("eventDate").textContent =
      eventDate.toLocaleDateString(isKhmer ? "km-KH" : "en-US", {
        year: "numeric",
        month: "long",
        day: "numeric",
      });

    document.getElementById("days").textContent = isKhmer
      ? toKhmerNumeral(days)
      : days;
    document.getElementById("hours").textContent = isKhmer
      ? toKhmerNumeral(hours)
      : hours;
    document.getElementById("minutes").textContent = isKhmer
      ? toKhmerNumeral(minutes)
      : minutes;
    document.getElementById("seconds").textContent = isKhmer
      ? toKhmerNumeral(seconds)
      : seconds;

    // Update progress bar
    const progress = 100 - (difference / totalDuration) * 100;
    document.getElementById("progress").style.width = `${progress}%`;

    // Update fun fact
    document.getElementById("funFact").textContent = isKhmer
      ? currentEvent.funFactKh
      : currentEvent.funFactEn;

    // Update event image
    document.getElementById("eventImage").src = currentEvent.image;
    document.getElementById("eventImage").alt = isKhmer
      ? currentEvent.nameKh
      : currentEvent.nameEn;
  }

  function changeEvent(direction) {
    currentEventIndex =
      (currentEventIndex + direction + events.length) % events.length;
    updateCountdown();
  }

  function toggleLanguage() {
    isKhmer = !isKhmer;
    updateUI();
    updateCountdown();
  }

  function updateUI() {
    document
      .querySelector("html")
      .setAttribute("lang", isKhmer ? "km" : "en");
    document.getElementById("mainTitle").textContent = isKhmer
      ? "ážšáž¶áž”áŸ‹ážáž™áž€áŸ’ážšáŸ„áž™áž–áŸ’ážšáž¹ážáŸ’ážáž·áž€áž¶ážšážŽáŸážáŸ’áž˜áŸ‚ážš"
      : "Khmer Event Countdown";
    document.getElementById("prevEvent").textContent = isKhmer
      ? "â† áž˜áž»áž“"
      : "â† Previous";
    document.getElementById("nextEvent").textContent = isKhmer
      ? "áž”áž“áŸ’áž‘áž¶áž”áŸ‹ â†’"
      : "Next â†’";
    document.getElementById("toggleLang").textContent = isKhmer
      ? "áž”áŸ’ážŠáž¼ážšáž—áž¶ážŸáž¶ / Switch Language"
      : "Switch Language / áž”áŸ’ážŠáž¼ážšáž—áž¶ážŸáž¶";
    document.getElementById("copyright").textContent = isKhmer
      ? "Â© áŸ¢áŸ áŸ¢áŸ¤ ážšáž¶áž”áŸ‹ážáž™áž€áŸ’ážšáŸ„áž™ážáŸ’áž˜áŸ‚ážšáŸ” ážšáž€áŸ’ážŸáž¶ážŸáž·áž‘áŸ’áž’áž·áž‚áŸ’ážšáž”áŸ‹áž™áŸ‰áž¶áž„áŸ”"
      : "Â© 2024 Khmer Countdown. All rights reserved.";

    document.getElementById("daysLabel").textContent = isKhmer
      ? "ážáŸ’áž„áŸƒ"
      : "Days";
    document.getElementById("hoursLabel").textContent = isKhmer
      ? "áž˜áŸ‰áŸ„áž„"
      : "Hours";
    document.getElementById("minutesLabel").textContent = isKhmer
      ? "áž“áž¶áž‘áž¸"
      : "Minutes";
    document.getElementById("secondsLabel").textContent = isKhmer
      ? "ážœáž·áž“áž¶áž‘áž¸"
      : "Seconds";

    document.getElementById("followUs").textContent = isKhmer
      ? "ážáž¶áž˜ážŠáž¶áž“áž™áž¾áž„áž“áŸ…áž›áž¾áž”ážŽáŸ’ážáž¶áž‰ážŸáž„áŸ’áž‚áž˜"
      : "Follow us on social media";
  }

  function shareOnFacebook() {
    const url = encodeURIComponent(window.location.href);
    const text = encodeURIComponent(
      `Check out the countdown for ${events[currentEventIndex].nameEn}!`
    );
    window.open(
      `https://www.facebook.com/sharer/sharer.php?u=${url}&quote=${text}`,
      "_blank"
    );
  }

  function shareOnTwitter() {
    const url = encodeURIComponent(window.location.href);
    const text = encodeURIComponent(
      `Counting down to ${events[currentEventIndex].nameEn}! Check it out:`
    );
    window.open(
      `https://twitter.com/intent/tweet?url=${url}&text=${text}`,
      "_blank"
    );
  }

  document
    .getElementById("prevEvent")
    .addEventListener("click", () => changeEvent(-1));
  document
    .getElementById("nextEvent")
    .addEventListener("click", () => changeEvent(1));
  document
    .getElementById("toggleLang")
    .addEventListener("click", toggleLanguage);

  // Initialize particles.js
  particlesJS("particles-js", {
    particles: {
      number: { value: 80, density: { enable: true, value_area: 800 } },
      color: { value: "#ffffff" },
      shape: { type: "circle" },
      opacity: { value: 0.5, random: false },
      size: { value: 3, random: true },
      line_linked: {
        enable: true,
        distance: 150,
        color: "#ffffff",
        opacity: 0.4,
        width: 1,
      },
      move: {
        enable: true,
        speed: 6,
        direction: "none",
        random: false,
        straight: false,
        out_mode: "out",
        bounce: false,
      },
    },
    interactivity: {
      detect_on: "canvas",
      events: {
        onhover: { enable: true, mode: "repulse" },
        onclick: { enable: true, mode: "push" },
        resize: true,
      },
      modes: {
        repulse: { distance: 100, duration: 0.4 },
        push: { particles_nb: 4 },
      },
    },
    retina_detect: true,
  });

  // Theme toggle functionality
  const themeToggle = document.getElementById("themeToggle");
  themeToggle.addEventListener("click", () => {
    document.body.classList.toggle("dark-theme");
    themeToggle.textContent = document.body.classList.contains("dark-theme")
      ? "â˜€ï¸"
      : "ðŸŒ“";
  });

  updateCountdown();
  setInterval(updateCountdown, 1000);

  // Check for notifications permission and request if not granted
  if ("Notification" in window) {
    if (
      Notification.permission !== "granted" &&
      Notification.permission !== "denied"
    ) {
      Notification.requestPermission().then(function (permission) {
        if (permission === "granted") {
          console.log("Notification permission granted.");
        }
      });
    }
  }

  // Set notification for 1 day before each event
  function setEventNotifications() {
    events.forEach((event) => {
      const eventDate = new Date(event.date);
      const notificationDate = new Date(
        eventDate.getTime() - 24 * 60 * 60 * 1000
      );
      const now = new Date();

      if (notificationDate > now) {
        const timeUntilNotification =
          notificationDate.getTime() - now.getTime();
        setTimeout(() => {
          if (Notification.permission === "granted") {
            new Notification(`Upcoming Event: ${event.nameEn}`, {
              body: `${event.nameEn} is tomorrow!`,
              icon: "/path/to/icon.png", // Add an appropriate icon path
            });
          }
        }, timeUntilNotification);
      }
    });
  }

  setEventNotifications();